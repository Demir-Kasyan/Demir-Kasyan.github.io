<!DOCTYPE html>
<html lang="en">
<head>
  <title>TEST_ARCore B&W'develop</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, user-scalable=no,
  minimum-scale=1.0, maximum-scale=1.0">
</head>
<body>
<script src="./three.addons/three.module.js"></script>
<script src="./three.addons/VRControls.js"></script>
<script src="./three.addons/three.ar.js"></script>
<script>
var vrDisplay, vrControls, arView;
var canvas, camera, scene, renderer;
var BOX_DISTANCE = 1.5;
var BOX_SIZE = 0.25;
var BOX_QUANTITY = 6;
var boxesAdded = false;

function init() {
  renderer = new THREE.WebGLRenderer({ alpha: true });
  renderer.setPixelRatio(window.devicePixelRatio);
  renderer.setSize(window.innerWidth, window.innerHeight);
  renderer.autoClear = false;
  canvas = renderer.domElement;
  document.body.appendChild(canvas);
  scene = new THREE.Scene();

  arView = new THREE.ARView(vrDisplay, renderer);

  camera = new THREE.ARPerspectiveCamera(
    vrDisplay,
    60,
    window.innerWidth / window.innerHeight,
    vrDisplay.depthNear,
    vrDisplay.depthFar
  );

  vrControls = new THREE.VRControls(camera);

  window.addEventListener('resize', onWindowResize, false);

  update();
}

function update() {
  renderer.clearColor();

  arView.render();

  camera.updateProjectionMatrix();

  vrControls.update();

  if (!boxesAdded && !camera.position.y) {
    addBoxes();
  }

  renderer.clearDepth();
  renderer.render(scene, camera);

  vrDisplay.requestAnimationFrame(update);
}

function onWindowResize () {
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
}

function addBoxes () {
  for (var i = 0; i < BOX_QUANTITY; i++) {
    var angle = Math.PI * 2 * (i / BOX_QUANTITY);
    var geometry = new THREE.BoxGeometry(BOX_SIZE, BOX_SIZE, BOX_SIZE);
    var material = new THREE.MeshNormalMaterial();
    var cube = new THREE.Mesh(geometry, material);
    cube.position.set(Math.cos(angle) * BOX_DISTANCE, camera.position.y - 0.25, Math.sin(angle) * BOX_DISTANCE);
    scene.add(cube);
  }
  
  boxesAdded = true;
}
</script>
</body>
</html>